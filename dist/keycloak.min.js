!function(window,undefined){var Keycloak=function(config){if(!(this instanceof Keycloak))return new Keycloak(config);for(var adapter,callbackStorage,kc=this,refreshQueue=[],loginIframe={enable:!0,callbackList:[],interval:5},scripts=document.getElementsByTagName("script"),i=0;i<scripts.length;i++)-1===scripts[i].src.indexOf("keycloak.js")&&-1===scripts[i].src.indexOf("keycloak.min.js")||-1===scripts[i].src.indexOf("version=")||(kc.iframeVersion=scripts[i].src.substring(scripts[i].src.indexOf("version=")+8).split("&")[0]);var useNonce=!0,urlParams="";function getRealmUrl(){return void 0!==kc.authServerUrl?"/"==kc.authServerUrl.charAt(kc.authServerUrl.length-1)?kc.authServerUrl+"realms/"+encodeURIComponent(kc.realm):kc.authServerUrl+"/realms/"+encodeURIComponent(kc.realm):void 0}function processCallback(oauth,promise){var code=oauth.code,error=oauth.error,prompt=oauth.prompt,timeLocal=(new Date).getTime();if(error)if("none"!=prompt){var errorData={error:error,error_description:oauth.error_description};kc.onAuthError&&kc.onAuthError(errorData),promise&&promise.setError(errorData)}else promise&&promise.setSuccess();else if("standard"!=kc.flow&&(oauth.access_token||oauth.id_token)&&authSuccess(oauth.access_token,null,oauth.id_token,!0),"implicit"!=kc.flow&&code){var params="code="+code+"&grant_type=authorization_code",url=kc.endpoints.token(),req=new XMLHttpRequest;req.open("POST",url,!0),req.setRequestHeader("Content-type","application/x-www-form-urlencoded"),kc.clientId&&kc.clientSecret?req.setRequestHeader("Authorization","Basic "+btoa(kc.clientId+":"+kc.clientSecret)):params+="&client_id="+encodeURIComponent(kc.clientId),params+="&redirect_uri="+oauth.redirectUri,req.withCredentials=!0,req.onreadystatechange=function(){if(4==req.readyState)if(200==req.status){var tokenResponse=JSON.parse(req.responseText);authSuccess(tokenResponse.access_token,tokenResponse.refresh_token,tokenResponse.id_token,"standard"===kc.flow)}else kc.onAuthError&&kc.onAuthError(),promise&&promise.setError()},req.send(params)}function authSuccess(accessToken,refreshToken,idToken,fulfillPromise){setToken(accessToken,refreshToken,idToken,timeLocal=(timeLocal+(new Date).getTime())/2),useNonce&&(kc.tokenParsed&&kc.tokenParsed.nonce!=oauth.storedNonce||kc.refreshTokenParsed&&kc.refreshTokenParsed.nonce!=oauth.storedNonce||kc.idTokenParsed&&kc.idTokenParsed.nonce!=oauth.storedNonce)?(console.info("[KEYCLOAK] Invalid nonce, clearing token"),kc.clearToken(),promise&&promise.setError()):fulfillPromise&&(kc.onAuthSuccess&&kc.onAuthSuccess(),promise&&promise.setSuccess())}}function fileLoaded(xhr){return 0==xhr.status&&xhr.responseText&&xhr.responseURL.startsWith("file:")}function setToken(token,refreshToken,idToken,timeLocal){if(kc.tokenTimeoutHandle&&(clearTimeout(kc.tokenTimeoutHandle),kc.tokenTimeoutHandle=null),refreshToken?(kc.refreshToken=refreshToken,kc.refreshTokenParsed=decodeToken(refreshToken)):(delete kc.refreshToken,delete kc.refreshTokenParsed),idToken?(kc.idToken=idToken,kc.idTokenParsed=decodeToken(idToken)):(delete kc.idToken,delete kc.idTokenParsed),token){if(kc.token=token,kc.tokenParsed=decodeToken(token),kc.sessionId=kc.tokenParsed.session_state,kc.authenticated=!0,kc.subject=kc.tokenParsed.sub,kc.realmAccess=kc.tokenParsed.realm_access,kc.resourceAccess=kc.tokenParsed.resource_access,timeLocal&&(kc.timeSkew=Math.floor(timeLocal/1e3)-kc.tokenParsed.iat),null!=kc.timeSkew&&(console.info("[KEYCLOAK] Estimated time difference between browser and server is "+kc.timeSkew+" seconds"),kc.onTokenExpired)){var expiresIn=1e3*(kc.tokenParsed.exp-(new Date).getTime()/1e3+kc.timeSkew);console.info("[KEYCLOAK] Token expires in "+Math.round(expiresIn/1e3)+" s"),expiresIn<=0?kc.onTokenExpired():kc.tokenTimeoutHandle=setTimeout(kc.onTokenExpired,expiresIn)}}else delete kc.token,delete kc.tokenParsed,delete kc.subject,delete kc.realmAccess,delete kc.resourceAccess,kc.authenticated=!1}function decodeToken(str){switch((str=(str=(str=str.split(".")[1]).replace("/-/g","+")).replace("/_/g","/")).length%4){case 0:break;case 2:str+="==";break;case 3:str+="=";break;default:throw"Invalid token"}return str=(str=(str+"===").slice(0,str.length+str.length%4)).replace(/-/g,"+").replace(/_/g,"/"),str=decodeURIComponent(escape(atob(str))),str=JSON.parse(str)}function createUUID(){for(var s=[],i=0;i<36;i++)s[i]="0123456789abcdef".substr(Math.floor(16*Math.random()),1);return s[14]="4",s[19]="0123456789abcdef".substr(3&s[19]|8,1),s[8]=s[13]=s[18]=s[23]="-",s.join("")}function parseCallback(url){var oauth=function(url){var supportedParams;switch(kc.flow){case"standard":supportedParams=["code","state","session_state"];break;case"implicit":supportedParams=["access_token","id_token","state","session_state"];break;case"hybrid":supportedParams=["access_token","id_token","code","state","session_state"]}supportedParams.push("error"),supportedParams.push("error_description"),supportedParams.push("error_uri");var newUrl,parsed,queryIndex=url.indexOf("?"),fragmentIndex=url.indexOf("#");"query"===kc.responseMode&&-1!==queryIndex?(newUrl=url.substring(0,queryIndex),""!==(parsed=parseCallbackParams(url.substring(queryIndex+1,-1!==fragmentIndex?fragmentIndex:url.length),supportedParams)).paramsString&&(newUrl+="?"+parsed.paramsString),-1!==fragmentIndex&&(newUrl+=url.substring(fragmentIndex))):"fragment"===kc.responseMode&&-1!==fragmentIndex&&(newUrl=url.substring(0,fragmentIndex),""!==(parsed=parseCallbackParams(url.substring(fragmentIndex+1),supportedParams)).paramsString&&(newUrl+="#"+parsed.paramsString));if(parsed&&parsed.oauthParams)if("standard"===kc.flow||"hybrid"===kc.flow){if((parsed.oauthParams.code||parsed.oauthParams.error)&&parsed.oauthParams.state)return parsed.oauthParams.newUrl=newUrl,parsed.oauthParams}else if("implicit"===kc.flow&&(parsed.oauthParams.access_token||parsed.oauthParams.error)&&parsed.oauthParams.state)return parsed.oauthParams.newUrl=newUrl,parsed.oauthParams}(url);if(oauth){var oauthState=callbackStorage.get(oauth.state);return oauthState&&(oauth.valid=!0,oauth.redirectUri=oauthState.redirectUri,oauth.storedNonce=oauthState.nonce,oauth.prompt=oauthState.prompt),oauth}}function parseCallbackParams(paramsString,supportedParams){for(var p=paramsString.split("&"),result={paramsString:"",oauthParams:{}},i=0;i<p.length;i++){var t=p[i].split("=");-1!==supportedParams.indexOf(t[0])?result.oauthParams[t[0]]=t[1]:(""!==result.paramsString&&(result.paramsString+="&"),result.paramsString+=p[i])}return result}function createPromise(){return"function"==typeof Promise?((p={setSuccess:function(result){p.success=!0,p.resolve(result)},setError:function(result){p.success=!1,p.reject(result)}}).promise=new Promise(function(resolve,reject){p.resolve=resolve,p.reject=reject}),p.promise.success=function(callback){return p.promise.then(callback),p.promise},p.promise.error=function(callback){return p.promise.catch(callback),p.promise},p):function(){var p={setSuccess:function(result){p.success=!0,p.result=result,p.successCallback&&p.successCallback(result)},setError:function(result){p.error=!0,p.result=result,p.errorCallback&&p.errorCallback(result)},promise:{success:function(callback){return p.success?callback(p.result):p.error||(p.successCallback=callback),p.promise},error:function(callback){return p.error?callback(p.result):p.success||(p.errorCallback=callback),p.promise}}};return p}();var p}function setupCheckLoginIframe(){var promise=createPromise();if(!loginIframe.enable)return promise.setSuccess(),promise.promise;if(loginIframe.iframe)return promise.setSuccess(),promise.promise;var iframe=document.createElement("iframe");(loginIframe.iframe=iframe).onload=function(){var authUrl=kc.endpoints.authorize();"/"===authUrl.charAt(0)?loginIframe.iframeOrigin=window.location.origin?window.location.origin:window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""):loginIframe.iframeOrigin=authUrl.substring(0,authUrl.indexOf("/",8)),promise.setSuccess(),setTimeout(check,1e3*loginIframe.interval)};var src=kc.endpoints.checkSessionIframe();iframe.setAttribute("src",src),iframe.setAttribute("title","keycloak-session-iframe"),iframe.style.display="none",document.body.appendChild(iframe);window.addEventListener("message",function(event){if(event.origin===loginIframe.iframeOrigin&&loginIframe.iframe.contentWindow===event.source&&("unchanged"==event.data||"changed"==event.data||"error"==event.data)){"unchanged"!=event.data&&kc.clearToken();for(var callbacks=loginIframe.callbackList.splice(0,loginIframe.callbackList.length),i=callbacks.length-1;0<=i;--i){var promise=callbacks[i];"unchanged"==event.data?promise.setSuccess():promise.setError()}}},!1);var check=function(){checkLoginIframe(),kc.token&&setTimeout(check,1e3*loginIframe.interval)};return promise.promise}function checkLoginIframe(){var promise=createPromise();if(loginIframe.iframe&&loginIframe.iframeOrigin){var msg=kc.clientId+" "+kc.sessionId;loginIframe.callbackList.push(promise);var origin=loginIframe.iframeOrigin;1==loginIframe.callbackList.length&&loginIframe.iframe.contentWindow.postMessage(msg,origin)}else promise.setSuccess();return promise.promise}function loadAdapter(type){if(!type||"default"==type)return{login:function(options){return window.location.href=kc.createLoginUrl(options),createPromise().promise},logout:function(options){return window.location.href=kc.createLogoutUrl(options),createPromise().promise},register:function(options){return window.location.href=kc.createRegisterUrl(options),createPromise().promise},accountManagement:function(){var accountUrl=kc.createAccountUrl();if(void 0===accountUrl)throw"Not supported by the OIDC server";return window.location.href=accountUrl,createPromise().promise},redirectUri:function(options,encodeHash){return 1==arguments.length&&(encodeHash=!0),options&&options.redirectUri?options.redirectUri:kc.redirectUri?kc.redirectUri:location.href}};if("cordova"!=type)throw"invalid adapter type: "+type;loginIframe.enable=!1;var cordovaOpenWindowWrapper=function(loginUrl,target,options){return window.cordova&&window.cordova.InAppBrowser?window.cordova.InAppBrowser.open(loginUrl,target,options):window.open(loginUrl,target,options)};return{login:function(options){var promise=createPromise(),o="location=no";options&&"none"==options.prompt&&(o+=",hidden=yes");var loginUrl=kc.createLoginUrl(options),ref=cordovaOpenWindowWrapper(loginUrl,"_blank",o),completed=!1;return ref.addEventListener("loadstart",function(event){0==event.url.indexOf("http://localhost")&&(processCallback(parseCallback(event.url),promise),ref.close(),completed=!0)}),ref.addEventListener("loaderror",function(event){completed||(0==event.url.indexOf("http://localhost")?(processCallback(parseCallback(event.url),promise),ref.close(),completed=!0):(promise.setError(),ref.close()))}),promise.promise},logout:function(options){var error,promise=createPromise(),logoutUrl=kc.createLogoutUrl(options),ref=cordovaOpenWindowWrapper(logoutUrl,"_blank","location=no,hidden=yes");return ref.addEventListener("loadstart",function(event){0==event.url.indexOf("http://localhost")&&ref.close()}),ref.addEventListener("loaderror",function(event){0==event.url.indexOf("http://localhost")||(error=!0),ref.close()}),ref.addEventListener("exit",function(event){error?promise.setError():(kc.clearToken(),promise.setSuccess())}),promise.promise},register:function(){var registerUrl=kc.createRegisterUrl(),ref=cordovaOpenWindowWrapper(registerUrl,"_blank","location=no");ref.addEventListener("loadstart",function(event){0==event.url.indexOf("http://localhost")&&ref.close()})},accountManagement:function(){var accountUrl=kc.createAccountUrl();if(void 0===accountUrl)throw"Not supported by the OIDC server";var ref=cordovaOpenWindowWrapper(accountUrl,"_blank","location=no");ref.addEventListener("loadstart",function(event){0==event.url.indexOf("http://localhost")&&ref.close()})},redirectUri:function(options){return"http://localhost"}}}kc.init=function(initOptions){if(kc.authenticated=!1,callbackStorage=function(){try{return new LocalStorage}catch(err){}return new CookieStorage}(),adapter=initOptions&&"cordova"===initOptions.adapter?loadAdapter("cordova"):initOptions&&"default"===initOptions.adapter?loadAdapter():initOptions&&"object"==typeof initOptions.adapter?initOptions.adapter:window.Cordova||window.cordova?loadAdapter("cordova"):loadAdapter(),initOptions){if(void 0!==initOptions.useNonce&&(useNonce=initOptions.useNonce),void 0!==initOptions.checkLoginIframe&&(loginIframe.enable=initOptions.checkLoginIframe),void 0!==initOptions.urlParams&&(urlParams=function(params){var str="";for(var param in params)params.hasOwnProperty(param)&&(str+="&"+param+"="+encodeURIComponent(params[param]));return str}(initOptions.urlParams)),initOptions.checkLoginIframeInterval&&(loginIframe.interval=initOptions.checkLoginIframeInterval),"login-required"===initOptions.onLoad&&(kc.loginRequired=!0),initOptions.responseMode){if("query"!==initOptions.responseMode&&"fragment"!==initOptions.responseMode)throw"Invalid value for responseMode";kc.responseMode=initOptions.responseMode}if(initOptions.flow){switch(initOptions.flow){case"standard":kc.responseType="code";break;case"implicit":kc.responseType="id_token token";break;case"hybrid":kc.responseType="code id_token token";break;default:throw"Invalid value for flow"}kc.flow=initOptions.flow}null!=initOptions.timeSkew&&(kc.timeSkew=initOptions.timeSkew)}kc.responseMode||(kc.responseMode="fragment"),kc.responseType||(kc.responseType="code",kc.flow="standard");var promise=createPromise(),initPromise=createPromise();initPromise.promise.success(function(){kc.onReady&&kc.onReady(kc.authenticated),promise.setSuccess(kc.authenticated)}).error(function(errorData){promise.setError(errorData)});var configPromise=function(url){var configUrl,promise=createPromise();config?"string"==typeof config&&(configUrl=config):configUrl="keycloak.json";function setupOidcEndoints(oidcConfiguration){kc.endpoints=oidcConfiguration?{authorize:function(){return oidcConfiguration.authorization_endpoint},token:function(){return oidcConfiguration.token_endpoint},logout:function(){if(!oidcConfiguration.end_session_endpoint)throw"Not supported by the OIDC server";return oidcConfiguration.end_session_endpoint},checkSessionIframe:function(){if(!oidcConfiguration.check_session_iframe)throw"Not supported by the OIDC server";return oidcConfiguration.check_session_iframe},register:function(){throw'Redirection to "Register user" page not supported in standard OIDC mode'},userinfo:function(){if(!oidcConfiguration.userinfo_endpoint)throw"Not supported by the OIDC server";return oidcConfiguration.userinfo_endpoint}}:{authorize:function(){return getRealmUrl()+"/protocol/openid-connect/auth"},token:function(){return getRealmUrl()+"/protocol/openid-connect/token"},logout:function(){return getRealmUrl()+"/protocol/openid-connect/logout"},checkSessionIframe:function(){var src=getRealmUrl()+"/protocol/openid-connect/login-status-iframe.html";return kc.iframeVersion&&(src=src+"?version="+kc.iframeVersion),src},register:function(){return getRealmUrl()+"/protocol/openid-connect/registrations"},userinfo:function(){return getRealmUrl()+"/protocol/openid-connect/userinfo"}}}if(configUrl){var req=new XMLHttpRequest;req.open("GET",configUrl,!0),req.setRequestHeader("Accept","application/json"),req.onreadystatechange=function(){if(4==req.readyState)if(200==req.status||fileLoaded(req)){var config=JSON.parse(req.responseText);kc.authServerUrl=config["auth-server-url"],kc.realm=config.realm,kc.clientId=config.resource,kc.clientSecret=(config.credentials||{}).secret,setupOidcEndoints(null),promise.setSuccess()}else promise.setError()},req.send()}else{if(!config.clientId)throw"clientId missing";kc.clientId=config.clientId,kc.clientSecret=(config.credentials||{}).secret;var oidcProvider=config.oidcProvider;if(oidcProvider)if("string"==typeof oidcProvider){var oidcProviderConfigUrl;oidcProviderConfigUrl="/"==oidcProvider.charAt(oidcProvider.length-1)?oidcProvider+".well-known/openid-configuration":oidcProvider+"/.well-known/openid-configuration";var req=new XMLHttpRequest;req.open("GET",oidcProviderConfigUrl,!0),req.setRequestHeader("Accept","application/json"),req.onreadystatechange=function(){if(4==req.readyState)if(200==req.status||fileLoaded(req)){var oidcProviderConfig=JSON.parse(req.responseText);setupOidcEndoints(oidcProviderConfig),promise.setSuccess()}else promise.setError()},req.send()}else setupOidcEndoints(oidcProvider),promise.setSuccess();else{if(!config.url)for(var scripts=document.getElementsByTagName("script"),i=0;i<scripts.length;i++)if(scripts[i].src.match(/.*keycloak\.js/)){config.url=scripts[i].src.substr(0,scripts[i].src.indexOf("/js/keycloak.js"));break}if(!config.realm)throw"realm missing";kc.authServerUrl=config.url,kc.realm=config.realm,setupOidcEndoints(null),promise.setSuccess()}}return promise.promise}();function onLoad(){var doLogin=function(prompt){prompt||(options.prompt="none"),kc.login(options).success(function(){initPromise.setSuccess()}).error(function(){initPromise.setError()})},options={};switch(initOptions.onLoad){case"check-sso":loginIframe.enable?setupCheckLoginIframe().success(function(){checkLoginIframe().success(function(){doLogin(!1)}).error(function(){initPromise.setSuccess()})}):doLogin(!1);break;case"login-required":doLogin(!0);break;default:throw"Invalid value for onLoad"}}return configPromise.success(function(){var callback=parseCallback(window.location.href);if(callback&&window.history.replaceState({},null,callback.newUrl),callback&&callback.valid)return setupCheckLoginIframe().success(function(){processCallback(callback,initPromise)}).error(function(e){initPromise.setError()});initOptions?initOptions.token&&initOptions.refreshToken?(setToken(initOptions.token,initOptions.refreshToken,initOptions.idToken),loginIframe.enable?setupCheckLoginIframe().success(function(){checkLoginIframe().success(function(){kc.onAuthSuccess&&kc.onAuthSuccess(),initPromise.setSuccess()}).error(function(){setToken(null,null,null),initPromise.setSuccess()})}):kc.updateToken(-1).success(function(){kc.onAuthSuccess&&kc.onAuthSuccess(),initPromise.setSuccess()}).error(function(){kc.onAuthError&&kc.onAuthError(),initOptions.onLoad?onLoad():initPromise.setError()})):initOptions.onLoad?onLoad():initPromise.setSuccess():initPromise.setSuccess()}),configPromise.error(function(){promise.setError()}),promise.promise},kc.login=function(options){return adapter.login(options)},kc.createLoginUrl=function(options){var baseUrl,state=createUUID(),nonce=createUUID(),redirectUri=adapter.redirectUri(options),callbackState={state:state,nonce:nonce,redirectUri:encodeURIComponent(redirectUri)};options&&options.prompt&&(callbackState.prompt=options.prompt),callbackStorage.add(callbackState),baseUrl=options&&"register"==options.action?kc.endpoints.register():kc.endpoints.authorize();var scope=options&&options.scope?"openid "+options.scope:"openid",url=baseUrl+"?client_id="+encodeURIComponent(kc.clientId)+"&redirect_uri="+encodeURIComponent(redirectUri)+"&state="+encodeURIComponent(state)+"&response_mode="+encodeURIComponent(kc.responseMode)+"&response_type="+encodeURIComponent(kc.responseType)+"&scope="+encodeURIComponent(scope);return useNonce&&(url=url+"&nonce="+encodeURIComponent(nonce)),options&&options.prompt&&(url+="&prompt="+encodeURIComponent(options.prompt)),options&&options.maxAge&&(url+="&max_age="+encodeURIComponent(options.maxAge)),options&&options.loginHint&&(url+="&login_hint="+encodeURIComponent(options.loginHint)),options&&options.idpHint&&(url+="&kc_idp_hint="+encodeURIComponent(options.idpHint)),options&&options.locale&&(url+="&ui_locales="+encodeURIComponent(options.locale)),options&&options.kcLocale&&(url+="&kc_locale="+encodeURIComponent(options.kcLocale)),url+=urlParams},kc.logout=function(options){return adapter.logout(options)},kc.createLogoutUrl=function(options){return kc.endpoints.logout()+"?redirect_uri="+encodeURIComponent(adapter.redirectUri(options,!1))},kc.register=function(options){return adapter.register(options)},kc.createRegisterUrl=function(options){return options||(options={}),options.action="register",kc.createLoginUrl(options)},kc.createAccountUrl=function(options){var realm=getRealmUrl(),url=void 0;return void 0!==realm&&(url=realm+"/account?referrer="+encodeURIComponent(kc.clientId)+"&referrer_uri="+encodeURIComponent(adapter.redirectUri(options)),url+=urlParams),url},kc.accountManagement=function(){return adapter.accountManagement()},kc.hasRealmRole=function(role){var access=kc.realmAccess;return!!access&&0<=access.roles.indexOf(role)},kc.hasResourceRole=function(role,resource){if(!kc.resourceAccess)return!1;var access=kc.resourceAccess[resource||kc.clientId];return!!access&&0<=access.roles.indexOf(role)},kc.loadUserProfile=function(){var url=getRealmUrl()+"/account",req=new XMLHttpRequest;req.open("GET",url,!0),req.setRequestHeader("Accept","application/json"),req.setRequestHeader("Authorization","bearer "+kc.token);var promise=createPromise();return req.onreadystatechange=function(){4==req.readyState&&(200==req.status?(kc.profile=JSON.parse(req.responseText),promise.setSuccess(kc.profile)):promise.setError())},req.send(),promise.promise},kc.loadUserInfo=function(){var url=kc.endpoints.userinfo(),req=new XMLHttpRequest;req.open("GET",url,!0),req.setRequestHeader("Accept","application/json"),req.setRequestHeader("Authorization","bearer "+kc.token);var promise=createPromise();return req.onreadystatechange=function(){4==req.readyState&&(200==req.status?(kc.userInfo=JSON.parse(req.responseText),promise.setSuccess(kc.userInfo)):promise.setError())},req.send(),promise.promise},kc.isTokenExpired=function(minValidity){if(!kc.tokenParsed||!kc.refreshToken&&"implicit"!=kc.flow)throw"Not authenticated";if(null==kc.timeSkew)return console.info("[KEYCLOAK] Unable to determine if token is expired as timeskew is not set"),!0;var expiresIn=kc.tokenParsed.exp-Math.ceil((new Date).getTime()/1e3)+kc.timeSkew;return minValidity&&(expiresIn-=minValidity),expiresIn<0},kc.updateToken=function(minValidity){var promise=createPromise();if(!kc.refreshToken)return promise.setError(),promise.promise;minValidity=minValidity||5;var exec=function(){var refreshToken=!1;if(-1==minValidity?(refreshToken=!0,console.info("[KEYCLOAK] Refreshing token: forced refresh")):kc.tokenParsed&&!kc.isTokenExpired(minValidity)||(refreshToken=!0,console.info("[KEYCLOAK] Refreshing token: token expired")),refreshToken){var params="grant_type=refresh_token&refresh_token="+kc.refreshToken,url=kc.endpoints.token();if(refreshQueue.push(promise),1==refreshQueue.length){var req=new XMLHttpRequest;req.open("POST",url,!0),req.setRequestHeader("Content-type","application/x-www-form-urlencoded"),req.withCredentials=!0,kc.clientId&&kc.clientSecret?req.setRequestHeader("Authorization","Basic "+btoa(kc.clientId+":"+kc.clientSecret)):params+="&client_id="+encodeURIComponent(kc.clientId);var timeLocal=(new Date).getTime();req.onreadystatechange=function(){if(4==req.readyState)if(200==req.status){console.info("[KEYCLOAK] Token refreshed"),timeLocal=(timeLocal+(new Date).getTime())/2;var tokenResponse=JSON.parse(req.responseText);setToken(tokenResponse.access_token,tokenResponse.refresh_token,tokenResponse.id_token,timeLocal),kc.onAuthRefreshSuccess&&kc.onAuthRefreshSuccess();for(var p=refreshQueue.pop();null!=p;p=refreshQueue.pop())p.setSuccess(!0)}else{console.warn("[KEYCLOAK] Failed to refresh token"),400==req.status&&kc.clearToken(),kc.onAuthRefreshError&&kc.onAuthRefreshError();for(p=refreshQueue.pop();null!=p;p=refreshQueue.pop())p.setError(!0)}},req.send(params)}}else promise.setSuccess(!1)};loginIframe.enable?checkLoginIframe().success(function(){exec()}).error(function(){promise.setError()}):exec();return promise.promise},kc.clearToken=function(){kc.token&&(setToken(null,null,null),kc.onAuthLogout&&kc.onAuthLogout(),kc.loginRequired&&kc.login())},kc.callback_id=0;var LocalStorage=function(){if(!(this instanceof LocalStorage))return new LocalStorage;localStorage.setItem("kc-test","test"),localStorage.removeItem("kc-test");function clearExpired(){for(var time=(new Date).getTime(),i=0;i<localStorage.length;i++){var key=localStorage.key(i);if(key&&0==key.indexOf("kc-callback-")){var value=localStorage.getItem(key);if(value)try{var expires=JSON.parse(value).expires;(!expires||expires<time)&&localStorage.removeItem(key)}catch(err){localStorage.removeItem(key)}}}}this.get=function(state){if(state){var key="kc-callback-"+state,value=localStorage.getItem(key);return value&&(localStorage.removeItem(key),value=JSON.parse(value)),clearExpired(),value}},this.add=function(state){clearExpired();var key="kc-callback-"+state.state;state.expires=(new Date).getTime()+36e5,localStorage.setItem(key,JSON.stringify(state))}},CookieStorage=function(){if(!(this instanceof CookieStorage))return new CookieStorage;this.get=function(state){if(state){var value=getCookie("kc-callback-"+state);return setCookie("kc-callback-"+state,"",cookieExpiration(-100)),value?JSON.parse(value):void 0}},this.add=function(state){setCookie("kc-callback-"+state.state,JSON.stringify(state),cookieExpiration(60))},this.removeItem=function(key){setCookie(key,"",cookieExpiration(-100))};var cookieExpiration=function(minutes){var exp=new Date;return exp.setTime(exp.getTime()+60*minutes*1e3),exp},getCookie=function(key){for(var name=key+"=",ca=document.cookie.split(";"),i=0;i<ca.length;i++){for(var c=ca[i];" "==c.charAt(0);)c=c.substring(1);if(0==c.indexOf(name))return c.substring(name.length,c.length)}return""},setCookie=function(key,value,expirationDate){var cookie=key+"="+value+"; expires="+expirationDate.toUTCString()+"; ";document.cookie=cookie}}};"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=Keycloak:(window.Keycloak=Keycloak,"function"==typeof define&&define.amd&&define("keycloak",[],function(){return Keycloak}))}(window);